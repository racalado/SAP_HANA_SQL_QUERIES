SELECT RESULT, 
CASE WHEN GRUPO = 'GRUPO_A' THEN 'GRUPO_A' ELSE 'GRUPO_B' END GRUPOX
, COUNT(*) QTT, SUM(KWH_RECUPERADO) ENERGIA FROM
(
SELECT *,
CASE 
WHEN ERDAT IS NOT NULL AND LEFT(DATA_ENCE,7) = LEFT(ERDAT,7) THEN 'MES'
  WHEN ERDAT IS NOT NULL AND LEFT(ADD_MONTHS(DATA_ENCE,+1),7) = LEFT(ERDAT,7) THEN 'MES-1' 
    WHEN ERDAT IS NOT NULL AND LEFT(ADD_MONTHS(DATA_ENCE,+2),7) = LEFT(ERDAT,7) THEN 'MES-2' 
        WHEN ERDAT IS NOT NULL  THEN 'MES>-2' 
  ELSE '' END RESULT

FROM "CLP124051"."PLANILHAO_NOTA_CI"
WHERE ERDAT >= '2019-01-01' AND GRUPO <> 'IP_ESTIMADA'
AND EQUIPE = 'CELPE'
--ORDER BY KWH_RECUPERADO DESC
)
GROUP BY  CASE WHEN GRUPO = 'GRUPO_A' THEN 'GRUPO_A' ELSE 'GRUPO_B' END, RESULT